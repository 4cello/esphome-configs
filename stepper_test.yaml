substitutions:
    devicename: stepper_test

esphome:
  name: $devicename
  platform: ESP8266
  board: nodemcuv2
  build_path: build/$devicename

wifi:
  ssid: !secret ssid
  password: !secret wifi_password
  #use_address: 192.168.144.182
  #manual_ip:
  #  static_ip: 192.168.144.93
  #  gateway: 192.168.144.1
  #  subnet: 255.255.255.0

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "$devicename"
    password: !secret ap_password

# Enable logging
logger:
  baud_rate: 0

ota:

mqtt:
  broker: !secret mqtt_broker 
  topic_prefix: esphome/$devicename
  username: !secret mqtt_username
  password: !secret mqtt_password
  birth_message:
  will_message:
  on_message:
    - topic: esphome/$devicename/the_stepper/cmd
      then:
        - logger.log: "Received stepper command"
        - stepper.report_position:
            id: the_stepper
            position: 0
        - stepper.set_target:
            id: the_stepper
            target: !lambda return atoi(x.c_str());

stepper:
  - platform: a4988
    id: the_stepper
    step_pin: D1
    dir_pin: D2
    max_speed: 1000 steps/s
    acceleration: 1000 steps/s^2
    deceleration: 1000 steps/s^2
    sleep_pin: D0
